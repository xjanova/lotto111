# Admin Risk Management & Profit Control System
# ระบบควบคุมความเสี่ยง & กำไร - Lotto Platform

> **เอกสารลับ — เฉพาะ Super Admin เท่านั้น**
> ระบบนี้คือหัวใจหลักของการบริหารกำไร ควบคุม Win Rate ทั้งระบบแบบ real-time

---

## 1. ภาพรวมระบบ (System Overview)

```
┌─────────────────────────────────────────────────────────────────┐
│                    ADMIN CONTROL CENTER                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────────────┐  │
│  │  Real-time   │  │   AI Win     │  │  User Risk           │  │
│  │  Dashboard   │  │   Rate       │  │  Profiling           │  │
│  │  (P&L Live)  │  │   Engine     │  │  (Per-User Control)  │  │
│  └──────┬───────┘  └──────┬───────┘  └──────────┬───────────┘  │
│         │                 │                      │              │
│  ┌──────▼─────────────────▼──────────────────────▼───────────┐  │
│  │              RISK MANAGEMENT ENGINE                        │  │
│  │  ┌─────────┐ ┌──────────┐ ┌───────────┐ ┌──────────────┐ │  │
│  │  │ Global  │ │ Per-User │ │Per-Lottery │ │  Per-Number  │ │  │
│  │  │Win Rate │ │Win Rate  │ │ Control   │ │  Control     │ │  │
│  │  │ Control │ │ Override │ │           │ │  (เลขอั้น)    │ │  │
│  │  └─────────┘ └──────────┘ └───────────┘ └──────────────┘ │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │              ANALYTICS & REPORTING                        │   │
│  │  • Real-time P&L          • User Profitability Matrix    │   │
│  │  • Risk Exposure          • AI Prediction Accuracy       │   │
│  │  • Payout Forecast        • Anomaly Detection            │   │
│  └──────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

---

## 2. Global Win Rate Control (ควบคุมเรทชนะทั้งระบบ)

### 2.1 แนวคิด
Admin ตั้งค่า **เปอร์เซ็นต์กำไรที่ต้องการ** → ระบบ AI ปรับอัตราจ่ายอัตโนมัติ

### 2.2 ตัวแปรควบคุม

| Parameter | Description | Default | Range |
|-----------|-------------|---------|-------|
| `global_target_margin` | % กำไรเป้าหมายของระบบ | 15% | 5-40% |
| `global_max_win_rate` | Win Rate สูงสุดที่ยอมให้ | 35% | 10-50% |
| `global_min_win_rate` | Win Rate ต่ำสุด (ไม่ให้ต่ำเกินจนผู้ใช้หนี) | 20% | 5-30% |
| `auto_adjust_enabled` | เปิด AI ปรับอัตโนมัติ | true | - |
| `adjustment_sensitivity` | ความไวในการปรับ (1-10) | 5 | 1-10 |
| `max_single_payout` | จ่ายสูงสุดต่อโพย | 500,000 | - |
| `max_daily_payout` | จ่ายสูงสุดต่อวัน (ทั้งระบบ) | 5,000,000 | - |

### 2.3 วิธีการทำงาน

```
1. Admin ตั้งเป้า: กำไร 15%
2. ระบบคำนวณ real-time:
   - ยอดแทงรวมวันนี้: 1,000,000 บาท
   - ยอดจ่ายรวมวันนี้: 750,000 บาท
   - กำไรปัจจุบัน: 25% ✅ (เกินเป้า)

3. ถ้ากำไรต่ำกว่าเป้า → AI ปรับ:
   - ลดอัตราจ่ายเลขบางตัว (เลขที่คนแทงเยอะ)
   - เพิ่มเลขอั้น
   - ปรับ max bet ลง

4. ถ้ากำไรสูงเกินเป้า → AI ปรับ:
   - เพิ่มอัตราจ่ายเล็กน้อย (ให้คนรู้สึกว่าได้เยอะ → แทงต่อ)
   - ลดเลขอั้น
   - ปล่อยให้ถูกบ้าง
```

---

## 3. Per-User Win Rate Control (ควบคุมรายบุคคล)

### 3.1 User Risk Profile

ทุก user จะมี **Risk Profile** ที่ระบบคำนวณอัตโนมัติ

| Risk Level | เงื่อนไข | การดำเนินการ |
|-----------|---------|-------------|
| 🟢 **ปลา (Fish)** | เสียสุทธิ, แทงน้อย | ปล่อยให้ถูกบ้าง → ดึงให้เล่นต่อ |
| 🟡 **ปกติ (Normal)** | ได้/เสียสมดุล | ใช้อัตราปกติ |
| 🟠 **ระวัง (Watch)** | เริ่มได้เยอะ | เฝ้าระวัง, ลด win rate เล็กน้อย |
| 🔴 **อันตราย (Danger)** | ได้เยอะมากต่อเนื่อง | ลด win rate, เพิ่มเลขอั้น, จำกัดวงเงิน |
| ⚫ **VIP Whale** | แทงเยอะมาก (ไม่ว่าได้/เสีย) | ดูแลพิเศษ, Admin กำหนดเอง |

### 3.2 Per-User Override

Admin สามารถตั้งค่า **แต่ละคน** แยกได้:

```
User: สมชาย (ID: 12345)
├── Win Rate Override:     25%  (ค่าปกติ 30%)
├── Max Bet Per Ticket:    5,000 บาท (ค่าปกติ 10,000)
├── Max Payout Per Day:    50,000 บาท (ค่าปกติ 100,000)
├── Blocked Numbers:       [123, 456, 789]  → เลขนี้แทงไม่ได้
├── Rate Adjustment:       -10%  (จ่ายน้อยกว่าปกติ 10%)
├── Auto-Adjust:           ON/OFF
├── Risk Level:            🔴 Danger (auto-calculated)
├── Net Profit (Lifetime): -85,000 บาท (ระบบกำไร 85,000 จากคนนี้)
└── Note:                  "แทงเก่ง ระวังเป็นพิเศษ"
```

### 3.3 AI Auto-Balance (เฉลี่ย Win Rate อัตโนมัติ)

```
เป้าหมาย: Win Rate เฉลี่ยทุกคน = 28%

User A: Win Rate 45% (ได้เยอะ)  → AI ลด rate เหลือ 20% ชั่วคราว
User B: Win Rate 15% (เสียเยอะ) → AI เพิ่ม rate เป็น 35% ชั่วคราว
User C: Win Rate 28% (พอดี)     → คงเดิม

ผลลัพธ์: ทุกคนรู้สึกว่ามีโอกาสถูก ไม่มีใครได้เยอะจนเกินไป
ระบบยังคงกำไรตามเป้าที่ตั้งไว้
```

---

## 4. Real-time Dashboard (แดชบอร์ดเรียลไทม์)

### 4.1 Live P&L Board (กำไร/ขาดทุน สด)

```
┌─────────────────────────────────────────────────────────────┐
│  📊 LIVE PROFIT & LOSS                    🔴 LIVE          │
├─────────────┬──────────────┬──────────────┬─────────────────┤
│ ยอดแทงวันนี้  │  ยอดจ่ายวันนี้   │  กำไรสุทธิ     │  Margin %      │
│ 1,234,567   │   876,543    │   358,024    │   29.0% ✅     │
├─────────────┼──────────────┼──────────────┼─────────────────┤
│ ยอดแทงเดือนนี้ │  ยอดจ่ายเดือน  │  กำไรเดือน     │  Margin %      │
│ 45,678,901  │  32,456,789  │  13,222,112  │   28.9% ✅     │
└─────────────┴──────────────┴──────────────┴─────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  📈 REAL-TIME CHART                                        │
│  [═══════════════════════════════════════▓▓▓▓]             │
│  กำไร 29% ─── เป้าหมาย 15% ─── ยอดรับ vs ยอดจ่าย          │
│  กราฟเส้น: ยอดแทงรายชั่วโมง / ยอดจ่ายรายชั่วโมง             │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 Risk Exposure Board (ความเสี่ยงที่เปิดอยู่)

```
┌─────────────────────────────────────────────────────────────┐
│  ⚠️ OPEN RISK EXPOSURE (ความเสี่ยงที่ยังไม่ออกผล)            │
├──────────────┬───────────┬───────────┬──────────────────────┤
│ หวยรัฐบาล     │ ยอดแทงรวม  │ Worst Case │ Expected Payout   │
│ (16 ก.พ.)    │ 5,600,000 │ 28,000,000│ 3,920,000 (70%)   │
├──────────────┼───────────┼───────────┼──────────────────────┤
│ ลาวประตูชัย   │   450,000 │  2,250,000│   315,000 (70%)   │
├──────────────┼───────────┼───────────┼──────────────────────┤
│ จับยี่กี รอบ 45│   120,000 │    600,000│    84,000 (70%)   │
└──────────────┴───────────┴───────────┴──────────────────────┘

เลขที่คนแทงเยอะสุด (⚠️ ถ้าออกจะจ่ายหนัก):
1. เลข 123 → ยอดแทง 250,000 → ถ้าออก จ่าย 250,000,000 ❌❌
2. เลข 456 → ยอดแทง 180,000 → ถ้าออก จ่าย 180,000,000 ❌
3. เลข 789 → ยอดแทง 120,000 → ถ้าออก จ่าย 120,000,000 ⚠️

💡 แนะนำ: อั้นเลข 123, 456 หรือลดอัตราจ่าย
```

### 4.3 User Profitability Matrix (ตารางกำไร/ขาดทุนรายบุคคล)

```
┌──────────────────────────────────────────────────────────────────────┐
│  👥 USER PROFITABILITY RANKING                    🔍 Search/Filter  │
├──────┬──────────┬────────────┬───────────┬──────────┬───────────────┤
│ Rank │ User     │ ยอดแทงรวม   │ ยอดถูกรวม  │ กำไรระบบ  │ Risk Level    │
├──────┼──────────┼────────────┼───────────┼──────────┼───────────────┤
│  1   │ สมชาย    │  500,000   │  750,000  │ -250,000 │ 🔴 Danger    │
│  2   │ สมหญิง   │  300,000   │  420,000  │ -120,000 │ 🟠 Watch     │
│  3   │ สมศักดิ์  │  200,000   │  250,000  │  -50,000 │ 🟠 Watch     │
│ ...  │ ...      │ ...        │ ...       │ ...      │ ...           │
│  98  │ สมปอง    │  150,000   │   30,000  │ +120,000 │ 🟢 Fish      │
│  99  │ สมพร     │  100,000   │   15,000  │  +85,000 │ 🟢 Fish      │
│ 100  │ สมใจ     │   80,000   │    5,000  │  +75,000 │ 🟢 Fish      │
├──────┴──────────┴────────────┴───────────┴──────────┴───────────────┤
│ TOTAL: 500 users │ 25,000,000 │ 18,750,000│+6,250,000│ Margin: 25% │
└──────────────────┴────────────┴───────────┴──────────┴──────────────┘

Filters: [ได้มากสุด ▼] [เสียมากสุด] [แทงเยอะสุด] [วันนี้/สัปดาห์/เดือน/ทั้งหมด]
Actions: [ปรับ Win Rate] [อั้นเลข] [จำกัดวงเงิน] [ระงับ] [ดูรายละเอียด]
```

### 4.4 Live Activity Feed (กิจกรรมสด)

```
┌─────────────────────────────────────────────────────────────┐
│  🔴 LIVE FEED                                    Auto-scroll │
├─────────────────────────────────────────────────────────────┤
│ 14:32:15 │ สมชาย แทง 123 (3ตัวบน) 500 บาท → หวยรัฐบาล     │
│ 14:32:12 │ สมหญิง แทง 45 (2ตัวล่าง) 200 บาท → ลาวประตูชัย  │
│ 14:32:08 │ 🎯 สมศักดิ์ ถูกรางวัล! ยี่กี รอบ 44 → 3,000 บาท  │
│ 14:32:05 │ 💰 สมพร ฝากเงิน 5,000 บาท                       │
│ 14:32:01 │ ⚠️ สมชาย แทงเลข 123 ซ้ำ! (รวม 2,500 บาท)       │
│ 14:31:58 │ สมใจ สร้างกลุ่ม "ลุ้นรวย"                        │
│ 14:31:55 │ 💸 สมปอง ถอนเงิน 10,000 บาท → รออนุมัติ          │
└─────────────────────────────────────────────────────────────┘
Filter: [ทั้งหมด] [แทงหวย] [ถูกรางวัล] [ฝาก/ถอน] [⚠️ แจ้งเตือน]
```

---

## 5. Number Control System (ระบบควบคุมเลข)

### 5.1 Auto-Limit (อั้นเลขอัตโนมัติ)

```
เมื่อยอดแทงเลขใดเลขหนึ่งเกิน threshold:
├── Level 1: ยอดรวม > 50,000   → แจ้งเตือน Admin
├── Level 2: ยอดรวม > 100,000  → ลดอัตราจ่ายอัตโนมัติ 20%
├── Level 3: ยอดรวม > 200,000  → ลดอัตราจ่าย 50%
├── Level 4: ยอดรวม > 500,000  → ปิดรับเลขนี้ (อั้น)
└── Admin Override: ปรับ threshold ได้ทั้งหมด
```

### 5.2 Smart Number Blocking (อั้นเลขอัจฉริยะ)

```
AI วิเคราะห์:
1. เลขที่มีคนแทงเยอะผิดปกติ → แจ้ง Admin
2. เลขที่ถ้าออก ระบบจะขาดทุน → แนะนำให้อั้น
3. เลขที่มีรูปแบบการแทงที่น่าสงสัย (bot/collusion) → Flag
4. คำนวณ "ถ้าออกเลขนี้ ระบบจ่ายเท่าไร" ทุกเลข → แสดง Top 10 เลขเสี่ยง
```

---

## 6. AI Auto-Adjust Engine (เครื่องยนต์ AI ปรับอัตโนมัติ)

### 6.1 Algorithm

```python
# Pseudocode สำหรับ AI Win Rate Engine

def calculate_adjustment(user, global_settings):
    # 1. คำนวณ User P&L
    user_total_bet = sum(user.bets.amount)
    user_total_win = sum(user.wins.amount)
    user_net = user_total_bet - user_total_win    # + = ระบบได้, - = ระบบเสีย
    user_win_rate = user_total_win / user_total_bet * 100

    # 2. คำนวณ Global P&L
    global_margin = global_settings.current_margin
    target_margin = global_settings.target_margin

    # 3. ตัดสินใจปรับ
    if user_win_rate > global_settings.max_win_rate:
        # User ได้เยอะเกินไป → ลด Win Rate
        adjustment = -1 * (user_win_rate - global_settings.max_win_rate) / 100
        actions = ['reduce_rate', 'add_number_limits', 'reduce_max_bet']

    elif user_win_rate < global_settings.min_win_rate:
        # User เสียเยอะเกินไป → เพิ่ม Win Rate เล็กน้อย (ดึงกลับมาเล่น)
        adjustment = (global_settings.min_win_rate - user_win_rate) / 200
        actions = ['increase_rate_slightly', 'give_free_spin']

    else:
        adjustment = 0
        actions = ['maintain']

    # 4. Apply global margin correction
    if global_margin < target_margin:
        # กำไรน้อยกว่าเป้า → ลด payout ทั้งระบบ
        global_adjustment = -0.02  # ลด 2%
    elif global_margin > target_margin * 1.5:
        # กำไรเยอะเกินเป้ามาก → เพิ่ม payout (ให้คนเล่นต่อ)
        global_adjustment = +0.01  # เพิ่ม 1%
    else:
        global_adjustment = 0

    return {
        'user_adjustment': adjustment,
        'global_adjustment': global_adjustment,
        'actions': actions,
        'new_effective_rate': base_rate * (1 + adjustment + global_adjustment)
    }
```

### 6.2 Adjustment Methods (วิธีการปรับ)

| Method | Description | Visible to User? |
|--------|-------------|------------------|
| **Rate Adjustment** | ปรับอัตราจ่ายขึ้น/ลง % | ❌ ไม่เห็น (ปรับเบื้องหลัง) |
| **Number Blocking** | อั้นเลขเฉพาะ user | ✅ เห็น "เลขนี้ปิดรับ" |
| **Max Bet Limit** | จำกัดเงินแทงสูงสุด | ✅ เห็น "แทงได้สูงสุด X บาท" |
| **Max Payout Cap** | จำกัดเงินจ่ายต่อวัน | ❌ ไม่เห็นจนกว่าจะถึง cap |
| **Delay Payout** | ชะลอการจ่าย (ตรวจสอบ) | ✅ เห็น "กำลังตรวจสอบ" |
| **Win Probability** | ปรับ probability ในยี่กี | ❌ ไม่เห็น |

---

## 7. Anomaly Detection (ตรวจจับความผิดปกติ)

### แจ้งเตือนอัตโนมัติเมื่อ:

| Event | Threshold | Action |
|-------|-----------|--------|
| User ถูกรางวัลต่อเนื่อง | > 5 ครั้งใน 24 ชม. | 🔔 แจ้ง Admin + Auto-watch |
| User แทงเลขเดียวเยอะมาก | > 10,000 บาท/เลข | 🔔 แจ้ง Admin |
| ยอดแทงเลขเดียวกันจากหลาย user | > 50,000 บาทรวม | ⚠️ สงสัย collusion |
| User แทงเร็วผิดปกติ | > 20 โพย/นาที | ⚠️ สงสัย Bot |
| ระบบขาดทุนรายชั่วโมง | > 100,000 บาท | 🚨 Emergency alert |
| User ใหม่ถูกเยอะทันที | Win > 10x deposit | 🔔 ตรวจสอบ Fraud |
| Pattern แทงซ้ำๆ | เหมือนกันทุกงวด | 🔔 Flag for review |

---

## 8. Reporting & Analytics (รายงาน & วิเคราะห์)

### 8.1 Daily Report (รายงานรายวัน - ส่งอัตโนมัติ)

```
📊 Daily Report - 08 ก.พ. 2026
═══════════════════════════════════
ยอดแทงรวม:        1,234,567 บาท
ยอดจ่ายรวม:         876,543 บาท
กำไรสุทธิ:          358,024 บาท
Margin:            29.0%
Win Rate เฉลี่ย:    28.5%

👥 สมาชิก:
- Active วันนี้:    234 คน
- สมัครใหม่:        12 คน
- ฝากเงิน:         45 รายการ (567,890 บาท)
- ถอนเงิน:         23 รายการ (345,678 บาท)

⚠️ Risk Alerts:
- 3 users ถูกรางวัลเยอะ (ดูรายละเอียด)
- เลข 789 ยอดแทงสูงมาก (120,000 บาท)
- 1 user สงสัย bot activity
═══════════════════════════════════
```

### 8.2 Custom Reports

- กำไร/ขาดทุน ตามช่วงเวลา
- กำไร/ขาดทุน ตามประเภทหวย
- กำไร/ขาดทุน ตามประเภทแทง (3ตัว, 2ตัว ฯลฯ)
- Top winners / Top losers
- ยอดแทงตามชั่วโมง (heatmap)
- User retention & churn analysis
- Affiliate performance
- Export: PDF, Excel, CSV

---

## 9. Admin Permissions (สิทธิ์การเข้าถึง)

| Feature | Admin | Super Admin |
|---------|-------|-------------|
| ดู Dashboard | ✅ | ✅ |
| ดู User List | ✅ | ✅ |
| ดู User Detail | ✅ | ✅ |
| อนุมัติ ฝาก/ถอน | ✅ | ✅ |
| ตั้งค่า Global Win Rate | ❌ | ✅ |
| ตั้งค่า Per-User Win Rate | ❌ | ✅ |
| ดู Risk Management | ✅ | ✅ |
| ปรับอัตราจ่าย | ❌ | ✅ |
| เปิด/ปิด AI Auto-Adjust | ❌ | ✅ |
| ดู P&L Report | ✅ | ✅ |
| Export Report | ❌ | ✅ |
| จัดการ Admin อื่น | ❌ | ✅ |
| ดู Audit Log | ✅ | ✅ |
| System Settings | ❌ | ✅ |
